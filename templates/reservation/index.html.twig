{% extends 'base1.html.twig' %}

{% block title %}New Reservation{% endblock %}
{% block sidebar %}
    <div class="app-brand demo">
        <a href="index.html" class="app-brand-link">
            <span class="app-brand-logo demo">
                <!-- Your logo SVG here -->
            </span>
            <span class="app-brand-text demo menu-text fw-bolder ms-2">Dashboard</span>
        </a>
    </div>

    <div class="menu-inner-shadow"></div>

    <ul class="menu-inner py-1">
        <li class="menu-item">
            <a href="{{ path('home') }}" class="menu-link">
                <i class="menu-icon tf-icons bx bx-home-circle"></i>
                <div>Dashboard</div>
            </a>
        </li>

        <li class="menu-item active">
            <a href="{{ path('app_reservation_new') }}" class="menu-link">
                <i class="menu-icon tf-icons bx bx-bus"></i>
                <div>Reservation</div>
            </a>
        </li>

        <li class="menu-item">
            <a href="{{ path('app_ticket_index') }}" class="menu-link">
                <i class="menu-icon tf-icons bx bx-id-card"></i>
                <div>Ticket</div>
            </a>
        </li>

        <li class="menu-item">
            <a href="{{ path('admin_waitlist_index') }}" class="menu-link">
                <i class="menu-icon tf-icons bx bx-id-card"></i>
                <div>Reservation (Admin)</div>
            </a>
        </li>
    </ul>
{% endblock %}
{% block body %}
<div class="container-xxl flex-grow-1 container-p-y">
    <h4 class="fw-bold py-3 mb-4">
        <span class="text-muted fw-light">Reservation /</span> New Reservation
    </h4>

    <div class="row">
        <!-- Left Column - Steps -->
        <div class="col-lg-5 mb-4">
            <div class="card how-it-works-card">
                <div class="card-body">
                    <h2 class="mb-4">Reservation Steps</h2>
                    
                    <div class="step-card active" data-step="1">
                        <div class="step-number">1</div>
                        <div class="step-content">
                            <h4>Transport & Driver</h4>
                            <p>Select your transport method and assign a driver if needed.</p>
                        </div>
                    </div>
                    
                    <div class="step-card" data-step="2">
                        <div class="step-number">2</div>
                        <div class="step-content">
                            <h4>Agent Selection</h4>
                            <p>Choose the agent that will assist you.</p>
                        </div>
                    </div>
                    
                    <div class="step-card" data-step="3">
                        <div class="step-number">3</div>
                        <div class="step-content">
                            <h4>Details & Payment</h4>
                            <p>Provide your personal information and payment details.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Right Column - Form -->
        <div class="col-lg-7">
            <div class="card">
                <div class="card-header">
                    <h5>Create New Reservation</h5>
                </div>
                <div class="card-body">
                    {{ form_start(form, {'attr': {'id': 'reservation-form'}}) }}
                    {{ form_widget(form.current_step) }}
                    
                    <!-- Step 1 Content -->
                    <div class="step-content" id="step-1">
                        <div class="mb-3">
                            {{ form_label(form.transport, 'Available Transports') }}
                            {{ form_widget(form.transport) }}
                        </div>
                        
                        <div class="mb-3" id="driver-selection" style="display: none;">
                            {{ form_label(form.driver, 'Available Drivers') }}
                            {{ form_widget(form.driver) }}
                        </div>
                        
                        <div class="d-flex justify-content-end mt-4">
                            <button type="button" class="btn btn-primary" id="next-to-step-2">
                                Continue <i class="bx bx-chevron-right"></i>
                            </button>
                        </div>
                    </div>
                    
                    <!-- Step 2 Content -->
                    <div class="step-content" id="step-2" style="display: none;">
                        <div class="mb-3">
                            {{ form_label(form.agent, 'Available Agents') }}
                            {{ form_widget(form.agent) }}
                        </div>
                        
                        <div class="d-flex justify-content-between mt-4">
                            <button type="button" class="btn btn-outline-secondary" id="back-to-step-1">
                                <i class="bx bx-chevron-left"></i> Back
                            </button>
                            <button type="button" class="btn btn-primary" id="next-to-step-3">
                                Continue <i class="bx bx-chevron-right"></i>
                            </button>
                        </div>
                    </div>
                    
                    <!-- Step 3 Content -->
                    <div class="step-content" id="step-3" style="display: none;">
                        <div class="mb-3">
                            {{ form_label(form.destination, 'Destination') }}
                            {{ form_widget(form.destination) }}
                        </div>
                        
                        <div class="row mb-3">
                            <div class="col-md-6">
                                {{ form_label(form.firstName, 'First Name') }}
                                {{ form_widget(form.firstName) }}
                            </div>
                            <div class="col-md-6">
                                {{ form_label(form.lastName, 'Last Name') }}
                                {{ form_widget(form.lastName) }}
                            </div>
                        </div>
                        
                        <div class="row mb-3">
                            <div class="col-md-6">
                                {{ form_label(form.email, 'Email') }}
                                {{ form_widget(form.email) }}
                            </div>
                            <div class="col-md-6">
                                {{ form_label(form.age, 'Age') }}
                                {{ form_widget(form.age) }}
                            </div>
                        </div>
                        
                        <div class="row mb-3">
                            <div class="col-md-6">
                                {{ form_label(form.date, 'Date') }}
                                {{ form_widget(form.date) }}
                            </div>
                            <div class="col-md-6">
                                {{ form_label(form.seats, 'Number of Seats') }}
                                {{ form_widget(form.seats) }}
                            </div>
                        </div>
                        
                        <div class="mb-3">
                            {{ form_label(form.paymentMode, 'Payment Mode') }}
                            {{ form_widget(form.paymentMode) }}
                        </div>
                        
                        <div class="d-flex justify-content-between mt-4">
                            <button type="button" class="btn btn-outline-secondary" id="back-to-step-2">
                                <i class="bx bx-chevron-left"></i> Back
                            </button>
                            <button type="submit" class="btn btn-success">
                                <i class="bx bx-check"></i> Complete Reservation
                            </button>
                        </div>
                    </div>
                    
                    {{ form_end(form) }}
                </div>
            </div>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Transport selection change handler
    const transportSelect = document.getElementById('{{ form.transport.vars.id }}');
    const driverSelection = document.getElementById('driver-selection');
    
    transportSelect.addEventListener('change', function() {
        if (this.value) {
            // In a real app, you would fetch available drivers via AJAX
            driverSelection.style.display = 'block';
        } else {
            driverSelection.style.display = 'none';
        }
    });

    // Step navigation
    function showStep(stepNumber) {
        // Hide all steps
        document.querySelectorAll('.step-content').forEach(step => {
            step.style.display = 'none';
        });
        
        // Show selected step
        document.getElementById(`step-${stepNumber}`).style.display = 'block';
        
        // Update current step in hidden field
        document.getElementById('{{ form.current_step.vars.id }}').value = stepNumber;
        
        // Update step indicators
        document.querySelectorAll('.step-card').forEach(step => {
            step.classList.remove('active');
            if (parseInt(step.dataset.step) === stepNumber) {
                step.classList.add('active');
            }
        });
    }

    // Button event handlers
    document.getElementById('next-to-step-2').addEventListener('click', () => {
        if (transportSelect.value) {
            showStep(2);
        } else {
            alert('Please select a transport first');
        }
    });
    
    document.getElementById('back-to-step-1').addEventListener('click', () => showStep(1));
    document.getElementById('next-to-step-3').addEventListener('click', () => {
        if (document.getElementById('{{ form.agent.vars.id }}').value) {
            showStep(3);
        } else {
            alert('Please select an agent');
        }
    });
    document.getElementById('back-to-step-2').addEventListener('click', () => showStep(2));
});
</script>

<style>
.how-it-works-card {
    background-color: #f8f9fa;
    border: none;
    height: 100%;
}

.step-card {
    display: flex;
    align-items: flex-start;
    padding: 1.5rem;
    margin-bottom: 1rem;
    border-radius: 0.5rem;
    background-color: white;
    box-shadow: 0 2px 6px rgba(0,0,0,0.05);
    transition: all 0.3s ease;
}

.step-card.active {
    border-left: 4px solid #696cff;
    background-color: #f8f7ff;
}

.step-number {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 32px;
    height: 32px;
    border-radius: 50%;
    background-color: #e9ecef;
    color: #6c757d;
    font-weight: bold;
    margin-right: 1rem;
    flex-shrink: 0;
}

.step-card.active .step-number {
    background-color: #696cff;
    color: white;
}

.step-content h4 {
    font-size: 1.1rem;
    margin-bottom: 0.5rem;
    color: #566a7f;
}

.step-card.active .step-content h4 {
    color: #696cff;
}

.step-content p {
    color: #6c757d;
    margin-bottom: 0;
    font-size: 0.9rem;
}
</style>
{% endblock %}